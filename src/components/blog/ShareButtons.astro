---
import { Icon } from 'astro-icon/components';

export interface Props {
  title: string;
  url: string;
  excerpt?: string;
  className?: string;
}

const { title, url, excerpt = '', className = '' } = Astro.props;
const shareText = excerpt || `Check out "${title}" by Furkan Eşref Yazıcı`;
---

<div class={`flex items-center gap-3 ${className}`}>
  <span class="text-sm font-medium text-gray-600 dark:text-slate-400">Share:</span>
  
  <!-- Twitter -->
  <button 
    class="share-button p-2 rounded-lg bg-blue-500 hover:bg-blue-600 text-white shadow-md hover:shadow-lg"
    onclick={`sharePost('${title}', '${url}', '${shareText}', 'twitter')`}
    aria-label="Share on Twitter"
  >
    <Icon name="tabler:brand-twitter" class="w-4 h-4" />
  </button>
  
  <!-- LinkedIn -->
  <button 
    class="share-button p-2 rounded-lg bg-blue-700 hover:bg-blue-800 text-white shadow-md hover:shadow-lg"
    onclick={`sharePost('${title}', '${url}', '${shareText}', 'linkedin')`}
    aria-label="Share on LinkedIn"
  >
    <Icon name="tabler:brand-linkedin" class="w-4 h-4" />
  </button>
  
  <!-- Reddit -->
  <button 
    class="share-button p-2 rounded-lg bg-orange-500 hover:bg-orange-600 text-white shadow-md hover:shadow-lg"
    onclick={`sharePost('${title}', '${url}', '${shareText}', 'reddit')`}
    aria-label="Share on Reddit"
  >
    <Icon name="tabler:brand-reddit" class="w-4 h-4" />
  </button>
  
  <!-- Copy Link -->
  <button 
    class="share-button p-2 rounded-lg bg-gray-600 hover:bg-gray-700 text-white shadow-md hover:shadow-lg"
    onclick={`sharePost('${title}', '${url}', '${shareText}', 'copy')`}
    aria-label="Copy Link"
  >
    <Icon name="tabler:link" class="w-4 h-4" />
  </button>
  
  <!-- Email -->
  <button 
    class="share-button p-2 rounded-lg bg-green-600 hover:bg-green-700 text-white shadow-md hover:shadow-lg"
    onclick={`sharePost('${title}', '${url}', '${shareText}', 'email')`}
    aria-label="Share via Email"
  >
    <Icon name="tabler:mail" class="w-4 h-4" />
  </button>
</div>

<script>
  (window as any).sharePost = function(title: string, url: string, text: string, platform: string) {
    const fullUrl = new URL(url, window.location.origin).href;
    
    switch(platform) {
      case 'twitter':
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(fullUrl)}`, '_blank', 'width=600,height=400');
        break;
      case 'linkedin':
        window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(fullUrl)}`, '_blank', 'width=600,height=400');
        break;
      case 'reddit':
        window.open(`https://reddit.com/submit?url=${encodeURIComponent(fullUrl)}&title=${encodeURIComponent(title)}`, '_blank', 'width=600,height=600');
        break;
      case 'email':
        window.location.href = `mailto:?subject=${encodeURIComponent(title)}&body=${encodeURIComponent(text + '\n\n' + fullUrl)}`;
        break;
      case 'copy':
        navigator.clipboard.writeText(fullUrl).then(() => {
          showToast('Link copied to clipboard!', 'success');
        }).catch(() => {
          showToast('Failed to copy link', 'error');
        });
        break;
    }
  };

  function showToast(message: string, type: string = 'success') {
    const toast = document.createElement('div');
    toast.textContent = message;
    toast.className = `fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg z-50 animate-slide-in-right ${
      type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
    }`;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
  }
</script>
